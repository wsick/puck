var puck;!function(t){t.version="0.1.0"}(puck||(puck={}));var puck;!function(t){!function(t){t[t.relativeToBounds=0]="relativeToBounds",t[t.absolute=1]="absolute"}(t.BrushMappingMode||(t.BrushMappingMode={}));t.BrushMappingMode}(puck||(puck={}));var puck;!function(t){function e(e,r){if("#"===r[0])n(e,r);else{var i=t.KnownColors[r];e.r=i.r,e.g=i.g,e.b=i.b,e.a=i.a}}function n(t,e){var n;null!=(n=i.exec(e))?(t.a=parseInt(n[1],16)/255,t.r=parseInt(n[2],16),t.g=parseInt(n[3],16),t.b=parseInt(n[4],16)):null!=(n=r.exec(e))&&(t.a=1,t.r=parseInt(n[1],16),t.g=parseInt(n[2],16),t.b=parseInt(n[3],16))}var r=/#([0-9a-fA-F][0-9a-fA-F]){1}([0-9a-fA-F][0-9a-fA-F]){1}([0-9a-fA-F][0-9a-fA-F]){1}/,i=/#([0-9a-fA-F][0-9a-fA-F]){1}([0-9a-fA-F][0-9a-fA-F]){1}([0-9a-fA-F][0-9a-fA-F]){1}([0-9a-fA-F][0-9a-fA-F]){1}/,o=function(){function t(n){this.r=0,this.g=0,this.b=0,this.a=1,n instanceof t?(this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a):"string"==typeof n&&e(this,n)}return t.prototype.add=function(e){var n=new t;return n.r=this.r+e.r,n.g=this.g+e.g,n.b=this.b+e.b,n.a=this.a+e.a,n},t.prototype.subtract=function(e){var n=new t;return n.r=this.r-e.r,n.g=this.g-e.g,n.b=this.b-e.b,n.a=this.a-e.a,n},t.prototype.multiply=function(e){var n=new t;return n.r=this.r*e,n.g=this.g*e,n.b=this.b*e,n.a=this.a*e,n},t.prototype.toString=function(){var t=Math.round(this.r)||0,e=Math.round(this.g)||0,n=Math.round(this.b)||0,r=this.a||0;return"rgba("+t+", "+e+", "+n+", "+r+")"},t.prototype.toHexString=function(){var t=(255*this.a).toString(16),e=this.r.toString(16),n=this.g.toString(16),r=this.b.toString(16);return"#"+t+e+n+r},t.prototype.toHexStringNoAlpha=function(){var t=this.r.toString(16),e=this.g.toString(16),n=this.b.toString(16);return"#"+t+e+n},t.equals=function(t,e){return t?e?t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a:!1:!e},t.lerp=function(e,n,r){var i=new t;return i.r=e.r+(n.r-e.r)*r,i.g=e.g+(n.g-e.g)*r,i.b=e.b+(n.b-e.b)*r,i.a=e.a+(n.a-e.a)*r,i},t.fromRgba=function(e,n,r,i){var o=new t;return o.r=e,o.g=n,o.b=r,o.a=i,o},t.fromHex=function(e){var r=new t;return n(r,e),r},t}();t.Color=o,t.KnownColors={AliceBlue:o.fromHex("#FFF0F8FF"),AntiqueWhite:o.fromHex("#FFFAEBD7"),Aqua:o.fromHex("#FF00FFFF"),Aquamarine:o.fromHex("#FF7FFFD4"),Azure:o.fromHex("#FFF0FFFF"),Beige:o.fromHex("#FFF5F5DC"),Bisque:o.fromHex("#FFFFE4C4"),Black:o.fromHex("#FF000000"),BlanchedAlmond:o.fromHex("#FFFFEBCD"),Blue:o.fromHex("#FF0000FF"),BlueViolet:o.fromHex("#FF8A2BE2"),Brown:o.fromHex("#FFA52A2A"),BurlyWood:o.fromHex("#FFDEB887"),CadetBlue:o.fromHex("#FF5F9EA0"),Chartreuse:o.fromHex("#FF7FFF00"),Chocolate:o.fromHex("#FFD2691E"),Coral:o.fromHex("#FFFF7F50"),CornflowerBlue:o.fromHex("#FF6495ED"),Cornsilk:o.fromHex("#FFFFF8DC"),Crimson:o.fromHex("#FFDC143C"),Cyan:o.fromHex("#FF00FFFF"),DarkBlue:o.fromHex("#FF00008B"),DarkCyan:o.fromHex("#FF008B8B"),DarkGoldenrod:o.fromHex("#FFB8860B"),DarkGray:o.fromHex("#FFA9A9A9"),DarkGreen:o.fromHex("#FF006400"),DarkKhaki:o.fromHex("#FFBDB76B"),DarkMagenta:o.fromHex("#FF8B008B"),DarkOliveGreen:o.fromHex("#FF556B2F"),DarkOrange:o.fromHex("#FFFF8C00"),DarkOrchid:o.fromHex("#FF9932CC"),DarkRed:o.fromHex("#FF8B0000"),DarkSalmon:o.fromHex("#FFE9967A"),DarkSeaGreen:o.fromHex("#FF8FBC8F"),DarkSlateBlue:o.fromHex("#FF483D8B"),DarkSlateGray:o.fromHex("#FF2F4F4F"),DarkTurquoise:o.fromHex("#FF00CED1"),DarkViolet:o.fromHex("#FF9400D3"),DeepPink:o.fromHex("#FFFF1493"),DeepSkyBlue:o.fromHex("#FF00BFFF"),DimGray:o.fromHex("#FF696969"),DodgerBlue:o.fromHex("#FF1E90FF"),Firebrick:o.fromHex("#FFB22222"),FloralWhite:o.fromHex("#FFFFFAF0"),ForestGreen:o.fromHex("#FF228B22"),Fuchsia:o.fromHex("#FFFF00FF"),Gainsboro:o.fromHex("#FFDCDCDC"),GhostWhite:o.fromHex("#FFF8F8FF"),Gold:o.fromHex("#FFFFD700"),Goldenrod:o.fromHex("#FFDAA520"),Gray:o.fromHex("#FF808080"),Green:o.fromHex("#FF008000"),GreenYellow:o.fromHex("#FFADFF2F"),Honeydew:o.fromHex("#FFF0FFF0"),HotPink:o.fromHex("#FFFF69B4"),IndianRed:o.fromHex("#FFCD5C5C"),Indigo:o.fromHex("#FF4B0082"),Ivory:o.fromHex("#FFFFFFF0"),Khaki:o.fromHex("#FFF0E68C"),Lavender:o.fromHex("#FFE6E6FA"),LavenderBlush:o.fromHex("#FFFFF0F5"),LawnGreen:o.fromHex("#FF7CFC00"),LemonChiffon:o.fromHex("#FFFFFACD"),LightBlue:o.fromHex("#FFADD8E6"),LightCoral:o.fromHex("#FFF08080"),LightCyan:o.fromHex("#FFE0FFFF"),LightGoldenrodYellow:o.fromHex("#FFFAFAD2"),LightGray:o.fromHex("#FFD3D3D3"),LightGreen:o.fromHex("#FF90EE90"),LightPink:o.fromHex("#FFFFB6C1"),LightSalmon:o.fromHex("#FFFFA07A"),LightSeaGreen:o.fromHex("#FF20B2AA"),LightSkyBlue:o.fromHex("#FF87CEFA"),LightSlateGray:o.fromHex("#FF778899"),LightSteelBlue:o.fromHex("#FFB0C4DE"),LightYellow:o.fromHex("#FFFFFFE0"),Lime:o.fromHex("#FF00FF00"),LimeGreen:o.fromHex("#FF32CD32"),Linen:o.fromHex("#FFFAF0E6"),Magenta:o.fromHex("#FFFF00FF"),Maroon:o.fromHex("#FF800000"),MediumAquamarine:o.fromHex("#FF66CDAA"),MediumBlue:o.fromHex("#FF0000CD"),MediumOrchid:o.fromHex("#FFBA55D3"),MediumPurple:o.fromHex("#FF9370DB"),MediumSeaGreen:o.fromHex("#FF3CB371"),MediumSlateBlue:o.fromHex("#FF7B68EE"),MediumSpringGreen:o.fromHex("#FF00FA9A"),MediumTurquoise:o.fromHex("#FF48D1CC"),MediumVioletRed:o.fromHex("#FFC71585"),MidnightBlue:o.fromHex("#FF191970"),MintCream:o.fromHex("#FFF5FFFA"),MistyRose:o.fromHex("#FFFFE4E1"),Moccasin:o.fromHex("#FFFFE4B5"),NavajoWhite:o.fromHex("#FFFFDEAD"),Navy:o.fromHex("#FF000080"),OldLace:o.fromHex("#FFFDF5E6"),Olive:o.fromHex("#FF808000"),OliveDrab:o.fromHex("#FF6B8E23"),Orange:o.fromHex("#FFFFA500"),OrangeRed:o.fromHex("#FFFF4500"),Orchid:o.fromHex("#FFDA70D6"),PaleGoldenrod:o.fromHex("#FFEEE8AA"),PaleGreen:o.fromHex("#FF98FB98"),PaleTurquoise:o.fromHex("#FFAFEEEE"),PaleVioletRed:o.fromHex("#FFDB7093"),PapayaWhip:o.fromHex("#FFFFEFD5"),PeachPuff:o.fromHex("#FFFFDAB9"),Peru:o.fromHex("#FFCD853F"),Pink:o.fromHex("#FFFFC0CB"),Plum:o.fromHex("#FFDDA0DD"),PowderBlue:o.fromHex("#FFB0E0E6"),Purple:o.fromHex("#FF800080"),Red:o.fromHex("#FFFF0000"),RosyBrown:o.fromHex("#FFBC8F8F"),RoyalBlue:o.fromHex("#FF4169E1"),SaddleBrown:o.fromHex("#FF8B4513"),Salmon:o.fromHex("#FFFA8072"),SandyBrown:o.fromHex("#FFF4A460"),SeaGreen:o.fromHex("#FF2E8B57"),SeaShell:o.fromHex("#FFFFF5EE"),Sienna:o.fromHex("#FFA0522D"),Silver:o.fromHex("#FFC0C0C0"),SkyBlue:o.fromHex("#FF87CEEB"),SlateBlue:o.fromHex("#FF6A5ACD"),SlateGray:o.fromHex("#FF708090"),Snow:o.fromHex("#FFFFFAFA"),SpringGreen:o.fromHex("#FF00FF7F"),SteelBlue:o.fromHex("#FF4682B4"),Tan:o.fromHex("#FFD2B48C"),Teal:o.fromHex("#FF008080"),Thistle:o.fromHex("#FFD8BFD8"),Tomato:o.fromHex("#FFFF6347"),Transparent:o.fromHex("#00FFFFFF"),Turquoise:o.fromHex("#FF40E0D0"),Violet:o.fromHex("#FFEE82EE"),Wheat:o.fromHex("#FFF5DEB3"),White:o.fromHex("#FFFFFFFF"),WhiteSmoke:o.fromHex("#FFF5F5F5"),Yellow:o.fromHex("#FFFFFF00"),YellowGreen:o.fromHex("#FF9ACD32")}}(puck||(puck={}));var puck;!function(t){var e;!function(t){!function(t){t[t.none=0]="none",t[t.opacity=1]="opacity",t[t.visible=2]="visible",t[t.stretch=4]="stretch",t[t.transform=8]="transform",t[t.padding=16]="padding",t[t.extents=32]="extents",t[t.newbounds=64]="newbounds",t[t.invalidate=128]="invalidate",t[t.down=15]="down",t[t.up=240]="up"}(t.DirtyFlags||(t.DirtyFlags={}));t.DirtyFlags}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e=t.element.DirtyFlags,n=function(){function n(t,e){this.init(t,e),Object.freeze(this)}return n.prototype.init=function(e,n){this.state=(e||new t.element.ElementState).reset(),this.composite=(n||new t.element.ElementComposite).reset(),this.processor={down:t.element.down.Processor.instance,up:t.element.up.Processor.instance,render:t.element.render.Processor.instance,hit:t.element.hit.Processor.instance},this.stencil=t.stencil.empty},Object.defineProperty(n.prototype,"opacity",{get:function(){return this.state.opacity},set:function(t){this.state.opacity!==t&&(this.state.opacity=t,this.composite.taint(e.opacity))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visible",{get:function(){return this.state.visible},set:function(t){this.state.visible!==t&&(this.state.visible=t,this.composite.taint(e.visible))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"transformOriginX",{get:function(){return this.state.transformOrigin.x},set:function(t){this.state.transformOrigin.x!==t&&(this.state.transformOrigin.x=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"transformOriginY",{get:function(){return this.state.transformOrigin.y},set:function(t){this.state.transformOrigin.y!==t&&(this.state.transformOrigin.y=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),n.prototype.resetTransform=function(){return la.mat3.identity(this.state.transform),this.composite.taint(e.transform),this},n.prototype.setTransform=function(t){return la.mat3.copyTo(t,this.state.transform),this.composite.taint(e.transform),this},n.prototype.applyTransform=function(t){return la.mat3.apply(this.state.transform,t),this.composite.taint(e.transform),this},n}();t.Element=n}(puck||(puck={}));var puck;!function(t){var e=t.element.DirtyFlags,n=function(){function n(t,e){this.init(t,e),Object.freeze(this)}return n.prototype.init=function(e,n){this.elements=[],this.state=(e||new t.container.ContainerState).reset(),this.composite=(n||new t.container.ContainerComposite).reset(),this.processor={down:t.container.down.Processor.instance,up:t.container.up.Processor.instance,render:t.container.render.Processor.instance,hit:t.container.hit.Processor.instance}},n.prototype.walk=function(t){var e=this.elements,n=-1;return t?(n=e.length,{next:function(){return n--,e[n]}}):{next:function(){return n++,e[n]}}},Object.defineProperty(n.prototype,"opacity",{get:function(){return this.state.opacity},set:function(t){this.state.opacity!==t&&(this.state.opacity=t,this.composite.taint(e.opacity))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visible",{get:function(){return this.state.visible},set:function(t){this.state.visible!==t&&(this.state.visible=t,this.composite.taint(e.visible))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"x",{get:function(){return this.state.offset.x},set:function(t){this.state.offset.x!==t&&(this.state.offset.x=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this.state.offset.y},set:function(t){this.state.offset.y!==t&&(this.state.offset.y=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"transformOriginX",{get:function(){return this.state.transformOrigin.x},set:function(t){this.state.transformOrigin.x!==t&&(this.state.transformOrigin.x=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"transformOriginY",{get:function(){return this.state.transformOrigin.y},set:function(t){this.state.transformOrigin.y!==t&&(this.state.transformOrigin.y=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),n.prototype.resetTransform=function(){return la.mat3.identity(this.state.transform),this.composite.taint(e.transform),this},n.prototype.setTransform=function(t){return la.mat3.copyTo(t,this.state.transform),this.composite.taint(e.transform),this},n.prototype.applyTransform=function(t){return la.mat3.apply(this.state.transform,t),this.composite.taint(e.transform),this},n}();t.Container=n}(puck||(puck={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},puck;!function(t){var e=t.element.DirtyFlags,n=function(n){function r(t,e){n.call(this,t,e),this.$fillwatch=null,this.$strokewatch=null}return __extends(r,n),r.prototype.init=function(e,n){this.state=(e||new t.visual.VisualState).reset(),this.composite=(n||new t.visual.VisualComposite).reset(),this.processor={down:t.element.down.Processor.instance,up:t.element.up.Processor.instance,render:t.visual.render.Processor.instance,hit:t.visual.hit.Processor.instance},this.stencil=t.stencil.visual},Object.defineProperty(r.prototype,"fill",{get:function(){return this.state.fill},set:function(t){var n=this;this.$fillwatch&&(this.$fillwatch.unwatch(),this.$fillwatch=null),!t==!this.state.fill&&this.composite.taint(e.extents).invalidate(),t!==this.state.fill&&(this.state.fill=t,this.composite.invalidate()),t&&(this.$fillwatch=t.watch(function(){return n.composite.invalidate()}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"stroke",{get:function(){return this.state.stroke},set:function(t){var n=this;this.$strokewatch&&(this.$strokewatch.unwatch(),this.$strokewatch=null),!t==!this.state.stroke&&this.composite.taint(e.padding).invalidate(),t!==this.state.stroke&&(this.state.stroke=t,this.composite.invalidate()),t&&(this.$strokewatch=t.watch(function(){return n.composite.invalidate()}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"strokeThickness",{get:function(){return this.state.strokeThickness},set:function(t){t!==this.state.strokeThickness&&(this.state.strokeThickness=t,this.composite.taint(e.padding))},enumerable:!0,configurable:!0}),r}(t.Element);t.Visual=n}(puck||(puck={}));var puck;!function(t){var e;!function(t){t.visual={draft:function(t){var e=t.state,n=e.size;if(la.rect.init(0,0,n.width,n.height,t.fillRect),la.rect.init(0,0,n.width,n.height,t.strokeRect),e.stroke&&e.strokeThickness>0){var r=e.strokeThickness/2;la.rect.shrink(t.fillRect,la.padding.init(r,r,r,r))}},draw:function(t,e){t.raw.beginPath(),t.raw.closePath()}}}(e=t.stencil||(t.stencil={}))}(puck||(puck={}));var puck;!function(t){var e=t.element.DirtyFlags,n=2*Math.PI,r=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.init=function(e,n){t.prototype.init.call(this,e,n),this.stencil=i},Object.defineProperty(n.prototype,"x",{get:function(){return this.state.offset.x},set:function(t){this.state.offset.x!==t&&(this.state.offset.x=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this.state.offset.y},set:function(t){this.state.offset.y!==t&&(this.state.offset.y=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this.state.size.width},set:function(t){this.state.size.width!==t&&(this.state.size.width=t,this.composite.taint(e.transform|e.extents))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.state.size.height},set:function(t){this.state.size.height!==t&&(this.state.size.height=t,this.composite.taint(e.transform|e.extents))},enumerable:!0,configurable:!0}),n}(t.Visual);t.Ellipse=r;var i={draft:t.stencil.visual.draft,draw:function(t,e){var r=e.fillRect;if(!(r.width<=0||r.height<=0)){var i=r.width/2,o=r.height/2,s=t.raw;s.beginPath(),s.ellipse(r.x+i,r.y+o,i,o,0,0,n,!1),s.closePath()}}}}(puck||(puck={}));var puck;!function(t){!function(t){t[t.evenodd=0]="evenodd",t[t.nonzero=1]="nonzero"}(t.FillRule||(t.FillRule={}));t.FillRule;!function(t){t[t.miter=0]="miter",t[t.bevel=1]="bevel",t[t.round=2]="round"}(t.PenLineJoin||(t.PenLineJoin={}));t.PenLineJoin;!function(t){t[t.flat=0]="flat",t[t.square=1]="square",t[t.round=2]="round",t[t.triangle=3]="triangle"}(t.PenLineCap||(t.PenLineCap={}));t.PenLineCap}(puck||(puck={}));var puck;!function(t){var e=function(){function t(){this.$onBeginProcess=null,this.$onEndProcess=null,this.$onBeginRender=null,this.$onEndRender=null}return t.prototype.onBeginProcess=function(t){return this.$onBeginProcess=t,this},t.prototype.onEndProcess=function(t){return this.$onEndProcess=t,this},t.prototype.onBeginRender=function(t){return this.$onBeginRender=t,this},t.prototype.onEndRender=function(t){return this.$onEndRender=t,this},t.prototype.beginProcess=function(){this.$onBeginProcess&&this.$onBeginProcess()},t.prototype.endProcess=function(){this.$onEndProcess&&this.$onEndProcess()},t.prototype.beginRender=function(){this.$onBeginRender&&this.$onBeginRender()},t.prototype.endRender=function(){this.$onEndRender&&this.$onEndRender()},t}();t.FrameDebug=e}(puck||(puck={}));var puck;!function(t){var e=function(){function e(){var e=this;this.$cachedBrush=null,this.$cachedBounds=la.rect.init(0,0,0,0),this.$changer=new t.internal.WatchChanger,this.$stops=new t.GradientStops,this.$spreadMethod=t.GradientSpreadMethod.pad,this.$mappingMode=t.BrushMappingMode.relativeToBounds,this.$stops.watch(function(){return e.$changer.on()})}return Object.defineProperty(e.prototype,"spreadMethod",{get:function(){return this.$spreadMethod},set:function(t){this.$spreadMethod!==t&&(this.$spreadMethod=t,this.$changer.on())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mappingMode",{get:function(){return this.$mappingMode},set:function(t){this.$mappingMode!==t&&(this.$mappingMode=t,this.$changer.on())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stops",{get:function(){return this.$stops},enumerable:!0,configurable:!0}),e.prototype.watch=function(t){return this.$changer.watch(t)},e.prototype.setup=function(t,e){this.$cachedBrush&&la.rect.equal(this.$cachedBounds,e)||(la.rect.copyTo(e,this.$cachedBounds),this.createBrush(t,e))},e.prototype.toHtml5Object=function(){return this.$cachedBrush},e.prototype.createBrush=function(e,n){switch(this.spreadMethod){case t.GradientSpreadMethod.pad:return this.createPad(e,n);default:case t.GradientSpreadMethod.reflect:return this.createReflect(e,n);case t.GradientSpreadMethod.repeat:return this.createRepeat(e,n)}},e.prototype.mapPoint=function(e,n){var r={x:n.x,y:n.y};return this.mappingMode===t.BrushMappingMode.relativeToBounds&&(r.x*=e.width,r.y*=e.height),r.x+=e.x,r.y+=e.y,r},e}();t.GradientBrush=e}(puck||(puck={}));var puck;!function(t){!function(t){t[t.pad=0]="pad",t[t.reflect=1]="reflect",t[t.repeat=2]="repeat"}(t.GradientSpreadMethod||(t.GradientSpreadMethod={}));t.GradientSpreadMethod}(puck||(puck={}));var puck;!function(t){var e=function(){function t(t,e){this.color=t,this.offset=e,Object.freeze(this)}return t}();t.GradientStop=e}(puck||(puck={}));var puck;!function(t){var e=function(){function e(){this.$backing=[],this.$changer=new t.internal.WatchChanger}return Object.defineProperty(e.prototype,"length",{get:function(){return this.$backing.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){return this.$backing.length=0,this.$changer.on(),this},e.prototype.add=function(t){return this.$backing.push(t),Object.freeze(t),this.$changer.on(),this},e.prototype.addMany=function(t){for(var e=this.$backing,n=0;n<t.length;n++)Object.freeze(t[n]);return e.push.apply(e,t),this.$changer.on(),this},e.prototype.insert=function(t,e){return this.$backing.splice(t,0,e),Object.freeze(e),this.$changer.on(),this},e.prototype.insertMany=function(t,e){for(var n=0;n<e.length;n++)Object.freeze(e[n]);for(var r=this.$backing,n=e.length-1;n>=0;n--)r.splice(t,0,e[n]);return this.$changer.on(),this},e.prototype.edit=function(t,e){return this.editAt(this.$backing.indexOf(t),e)},e.prototype.editAt=function(t,e){var n=this.$backing;return 0>t&&t>=n.length?this:(n[t]=e,Object.freeze(e),this.$changer.on(),this)},e.prototype.remove=function(t){return this.removeAt(this.$backing.indexOf(t))},e.prototype.removeAt=function(t){var e=this.$backing;return 0>t&&t>=e.length?this:(e.splice(t,1),this.$changer.on(),this)},e.prototype.watch=function(t){return this.$changer.watch(t)},e.prototype.iter=function(){return e.arrayIter(this.$backing)},e.arrayIter=function(t){var e=-1;return{next:function(){return e++,e>=t.length?{done:!0}:{done:!1,value:t[e]}}}},e}();t.PuckArray=e}(puck||(puck={}));var puck;!function(t){var e=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),n.prototype.paddedIter=function(){for(var e=null,n=null,r=this.$backing.slice(0),i=0;i<r.length;i++){var o=r[i];r.push(o),(!e||o.offset<e.offset)&&(e=o),(!n||o.offset>n.offset)&&(n=o)}return e&&r.unshift({offset:0,color:e.color}),n&&r.push({offset:1,color:n.color}),t.PuckArray.arrayIter(r)},n}(t.PuckArray);t.GradientStops=e}(puck||(puck={}));var puck;!function(t){var e=t.element.DirtyFlags,n=function(n){function i(t,e){n.call(this,t,e)}return __extends(i,n),i.prototype.init=function(e,n){var i=this;this.state=(e||new t.image.ImageState).reset(),this.composite=(n||new t.image.ImageComposite).reset(),this.processor={down:t.image.down.Processor.instance,up:t.image.up.Processor.instance,render:t.element.render.Processor.instance,hit:t.image.hit.Processor.instance},this.stencil=r,this.state.source.watch(function(){return i.onSourceChanged()},function(t){return i.onSourceErrored(t)},function(){return i.onSourceLoaded()})},Object.defineProperty(i.prototype,"sourceUri",{get:function(){return this.state.source.uri},set:function(t){this.state.source.uri=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stretch",{get:function(){return this.state.stretch},set:function(t){this.state.stretch!==t&&(this.state.stretch=t,this.composite.taint(e.stretch))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this.state.offset.x},set:function(t){this.state.offset.x!==t&&(this.state.offset.x=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.state.offset.y},set:function(t){this.state.offset.y!==t&&(this.state.offset.y=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this.state.size.width},set:function(t){this.state.size.width!==t&&(this.state.size.width=t,this.composite.taint(e.stretch|e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.state.size.height},set:function(t){this.state.size.height!==t&&(this.state.size.height=t,this.composite.taint(e.stretch|e.transform))},enumerable:!0,configurable:!0}),i.prototype.onSourceChanged=function(){this.setNaturalSize(0,0)},i.prototype.onSourceErrored=function(t){console.error("error loading image",t)},i.prototype.onSourceLoaded=function(){var t=this.state.source;this.setNaturalSize(t.naturalWidth,t.naturalHeight)},i.prototype.setNaturalSize=function(t,n){var r=this.state.natural;r.width=t,r.height=n,this.composite.taint(e.stretch|e.extents).invalidate()},i}(t.Element);t.Image=n;var r={draft:function(t){},draw:function(t,e){var n=e.state,r=e.composite;t.preapply(r.stretchTransform),n.source.draw(t.raw)}}}(puck||(puck={}));var puck;!function(t){var e=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),Object.defineProperty(n.prototype,"width",{get:function(){return this.$ctx.raw.canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.$ctx.raw.canvas.height},enumerable:!0,configurable:!0}),n.prototype.init=function(n,r){var i=this;e.prototype.init.call(this,n,r),this.frameDebug=new t.FrameDebug,this.$ctx=new t.render.RenderContext,this.$timer=new t.Timer(function(t){return i.onTick(t)})},n.prototype.attach=function(t){return this.$ctx.init(t),this},n.prototype.activate=function(){return this.$timer.enable(),this},n.prototype.deactivate=function(){return this.$timer.disable(),this},n.prototype.process=function(){return this.frameDebug.beginProcess(),t.engine.process(this),this.frameDebug.endProcess(),this},n.prototype.render=function(){var e=this.$ctx,n=this.composite.paint,r=e.raw;return this.frameDebug.beginRender(),r.fillStyle="#ffffff",r.fillRect(n.x,n.y,n.width,n.height),t.engine.render(this,e,n),this.frameDebug.endRender(),this},n.prototype.onTick=function(t){this.process().render()},n}(t.Container);t.Layer=e}(puck||(puck={}));var puck;!function(t){function e(t,e){var n=Math.min(1,Math.max(0,e.offset)),r=e.color.toString();t.addColorStop(n,r)}var n=function(n){function r(){n.apply(this,arguments),this.$start={x:0,y:0},this.$end={x:0,y:0}}return __extends(r,n),Object.defineProperty(r.prototype,"start",{get:function(){return this.$start},set:function(t){this.$start!==t&&(this.$start=t,Object.freeze(t),this.$changer.on())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"end",{get:function(){return this.$end},set:function(t){this.$end!==t&&(this.$end=t,Object.freeze(t),this.$changer.on())},enumerable:!0,configurable:!0}),r.prototype.createPad=function(t,n){for(var r=this.mapPoint(n,this.start),i=this.mapPoint(n,this.end),o=t.createLinearGradient(r.x,r.y,i.x,i.y),s=this.stops.iter(),a=s.next();!a.done;a=s.next())e(o,a.value)},r.prototype.createReflect=function(e,n){var r=this.mapPoint(n,this.start),i=this.mapPoint(n,this.end);return this.createInterpolated(e,t.linearGradient.createRepeatInterpolator(r,i,n))},r.prototype.createRepeat=function(e,n){var r=this.mapPoint(n,this.start),i=this.mapPoint(n,this.end);return this.createInterpolated(e,t.linearGradient.createReflectInterpolator(r,i,n))},r.prototype.createInterpolated=function(t,n){for(var r=t.createLinearGradient(n.x0,n.y0,n.x1,n.y1),i=this.stops.paddedIter();n.step();)for(var o=i.next();!o.done;o=i.next()){var s=o.value,a={color:s.color,offset:n.interpolate(s.offset)};a.offset>=0&&a.offset<=1&&e(r,a)}return r},r}(t.GradientBrush);t.LinearGradientBrush=n}(puck||(puck={}));var puck;!function(t){var e=t.element.DirtyFlags,n=function(n){function r(t,e){n.call(this,t,e)}return __extends(r,n),r.prototype.init=function(e,n){this.state=(e||new t.path.PathState).reset(),this.composite=(n||new t.path.PathComposite).reset(),this.processor={down:t.path.down.Processor.instance,up:t.path.up.Processor.instance,render:t.path.render.Processor.instance,hit:t.path.hit.Processor.instance},this.stencil=t.stencil.path},Object.defineProperty(r.prototype,"x",{get:function(){return this.state.offset.x},set:function(t){this.state.offset.x!==t&&(this.state.offset.x=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this.state.offset.y},set:function(t){this.state.offset.y!==t&&(this.state.offset.y=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this.state.size.width},set:function(t){this.state.size.width!==t&&(this.state.size.width=t,this.composite.taint(e.stretch|e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.state.size.height},set:function(t){this.state.size.height!==t&&(this.state.size.height=t,this.composite.taint(e.stretch|e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"stretch",{get:function(){return this.state.stretch},set:function(t){this.state.stretch!==t&&(this.state.stretch=t,this.composite.taint(e.stretch))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"path",{get:function(){return this.state.path},set:function(t){this.state.path!==t&&(this.state.path=t,this.composite.bounder.setPath(t),this.composite.taint(e.padding).invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fillRule",{get:function(){return this.state.fillRule},set:function(t){this.state.fillRule!==t&&(this.state.fillRule=t,this.composite.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"strokeLineCap",{get:function(){return this.state.strokeLineCap},set:function(t){this.state.strokeLineCap!==t&&(this.state.strokeLineCap=t,this.composite.taint(e.padding).invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"strokeLineJoin",{get:function(){return this.state.strokeLineJoin},set:function(t){this.state.strokeLineJoin!==t&&(this.state.strokeLineJoin=t,this.composite.taint(e.padding).invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"strokeMiterLimit",{get:function(){return this.state.strokeMiterLimit},set:function(t){this.state.strokeMiterLimit!==t&&(this.state.strokeMiterLimit=t,this.composite.taint(e.padding).invalidate())},enumerable:!0,configurable:!0}),r}(t.Visual);t.Path=n}(puck||(puck={}));var puck;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.PuckArray);t.Points=e}(puck||(puck={}));var puck;!function(t){var e=t.element.DirtyFlags,n=function(n){function r(t,e){n.call(this,t,e)}return __extends(r,n),r.prototype.init=function(e,n){var r=this;this.state=(e||new t.polyline.PolylineState).reset(),this.composite=(n||new t.path.PathComposite).reset(),this.processor={down:t.polyline.down.Processor.instance,up:t.path.up.Processor.instance,render:t.path.render.Processor.instance,hit:t.path.hit.Processor.instance},this.stencil=t.stencil.path,this.state.points.watch(function(){r.state.path&&r.state.path.reset()})},Object.defineProperty(r.prototype,"points",{get:function(){return this.state.points},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this.closed},set:function(t){this.state.closed!==t&&(this.state.closed=t,this.composite.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this.state.offset.x},set:function(t){this.state.offset.x!==t&&(this.state.offset.x=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this.state.offset.y},set:function(t){this.state.offset.y!==t&&(this.state.offset.y=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this.state.size.width},set:function(t){this.state.size.width!==t&&(this.state.size.width=t,this.composite.taint(e.stretch|e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.state.size.height},set:function(t){this.state.size.height!==t&&(this.state.size.height=t,this.composite.taint(e.stretch|e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"stretch",{get:function(){return this.state.stretch},set:function(t){this.state.stretch!==t&&(this.state.stretch=t,this.composite.taint(e.stretch))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fillRule",{get:function(){return this.state.fillRule},set:function(t){this.state.fillRule!==t&&(this.state.fillRule=t,this.composite.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"strokeLineCap",{get:function(){return this.state.strokeLineCap},set:function(t){this.state.strokeLineCap!==t&&(this.state.strokeLineCap=t,this.composite.taint(e.padding).invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"strokeLineJoin",{get:function(){return this.state.strokeLineJoin},set:function(t){this.state.strokeLineJoin!==t&&(this.state.strokeLineJoin=t,this.composite.taint(e.padding).invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"strokeMiterLimit",{get:function(){return this.state.strokeMiterLimit},set:function(t){this.state.strokeMiterLimit!==t&&(this.state.strokeMiterLimit=t,this.composite.taint(e.padding).invalidate())},enumerable:!0,configurable:!0}),r}(t.Visual);t.Polyline=n}(puck||(puck={}));var puck;!function(t){function e(t,e){var n=Math.min(1,Math.max(0,e.offset)),r=e.color.toString();t.addColorStop(n,r)}var n=document.createElement("canvas"),r=n.getContext("2d"),i=1e-10,o=function(o){function s(){o.apply(this,arguments),this.$center={x:.5,y:.5},this.$origin={x:.5,y:.5},this.$radius={x:.5,y:.5}}return __extends(s,o),Object.defineProperty(s.prototype,"center",{get:function(){return this.$center},set:function(t){this.$center!==t&&(this.$center=t,Object.freeze(t),this.$changer.on())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"origin",{get:function(){return this.$origin},set:function(t){this.$origin!==t&&(this.$origin=t,Object.freeze(t),
this.$changer.on())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"radiusX",{get:function(){return this.$radius.x},set:function(t){this.$radius.x!==t&&(this.$radius.x=t,this.$changer.on())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"radiusY",{get:function(){return this.$radius.y},set:function(t){this.$radius.y!==t&&(this.$radius.y=t,this.$changer.on())},enumerable:!0,configurable:!0}),s.prototype.createPad=function(t,n){for(var i=this.getPointData(n),o=(i.balanced?t:r).createRadialGradient(i.x0,i.y0,0,i.x1,i.y1,i.r1),s=this.stops.iter(),a=s.next();!a.done;a=s.next())e(o,a.value);return this.fit(t,o,i,n)},s.prototype.createReflect=function(t,e){var n=this.getPointData(e);return this.createInterpolated(n,e,!1)},s.prototype.createRepeat=function(t,e){var n=this.getPointData(e);return this.createInterpolated(n,e,!0)},s.prototype.createInterpolated=function(i,o,s){n.width=o.width,n.height=o.height,r.save(),i.balanced||r.scale(i.sx,i.sy),r.globalCompositeOperation="destination-over";for(var a=!1,c=this.stops.paddedIter(),u=t.radialGradient.createExtender(i,o);u.step();a=!a){for(var p=u.createGradient(r),f=c.next();!f.done;f=c.next()){var h=f.value,l={color:h.color,offset:s&&a?1-h.offset:h.offset};e(p,l)}r.fillStyle=p,r.beginPath(),r.arc(u.x1,u.y1,u.r1,0,2*Math.PI,!1),r.closePath(),r.fill()}var d=r.createPattern(n,"no-repeat");return r.restore(),d},s.prototype.getPointData=function(t){var e=this.mapPoint(t,this.center),n=this.mapPoint(t,this.origin),r=this.mapPoint(t,this.$radius),o=Math.max(r.x,r.y),s=Math.max(t.width,t.height),a=t.width/s,c=t.height/s;return{x0:n.x/a,y0:n.y/c,x1:e.x/a,y1:e.y/c,r1:o,side:s,sx:t.width/s,sy:t.height/s,balanced:Math.abs(r.x-r.y)<i}},s.prototype.fit=function(t,e,i,o){if(i.balanced)return e;n.width=o.width,n.height=o.height,r.save(),r.scale(i.sx,i.sy),r.fillStyle=e,r.fillRect(0,0,i.side,i.side);var s=t.createPattern(n,"no-repeat");return r.restore(),s},s}(t.GradientBrush);t.RadialGradientBrush=o}(puck||(puck={}));var puck;!function(t){var e=t.element.DirtyFlags,n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.init=function(e,n){t.prototype.init.call(this,e,n),this.stencil=r},Object.defineProperty(n.prototype,"x",{get:function(){return this.state.offset.x},set:function(t){this.state.offset.x!==t&&(this.state.offset.x=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this.state.offset.y},set:function(t){this.state.offset.y!==t&&(this.state.offset.y=t,this.composite.taint(e.transform))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this.state.size.width},set:function(t){this.state.size.width!==t&&(this.state.size.width=t,this.composite.taint(e.transform|e.extents))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.state.size.height},set:function(t){this.state.size.height!==t&&(this.state.size.height=t,this.composite.taint(e.transform|e.extents))},enumerable:!0,configurable:!0}),n}(t.Visual);t.Rectangle=n;var r={draft:t.stencil.visual.draft,draw:function(t,e){var n=e.fillRect;if(!(n.width<=0||n.height<=0)){var r=t.raw;r.beginPath(),r.rect(n.x,n.y,n.width,n.height),r.closePath()}}}}(puck||(puck={}));var puck;!function(t){var e=function(){function e(e){this.$color=null,this.$changer=new t.internal.WatchChanger,this.color=new t.Color(e)}return Object.defineProperty(e.prototype,"color",{get:function(){return this.$color},set:function(e){t.Color.equals(this.$color,e)||this.$changer.on(),this.$color=e},enumerable:!0,configurable:!0}),e.prototype.watch=function(t){return this.$changer.watch(t)},e.prototype.setup=function(t,e){},e.prototype.toHtml5Object=function(){return this.color.toString()},e}();t.SolidColorBrush=e}(puck||(puck={}));var puck;!function(t){!function(t){t[t.none=0]="none",t[t.fill=1]="fill",t[t.uniform=2]="uniform",t[t.uniformToFill=3]="uniformToFill"}(t.Stretch||(t.Stretch={}));t.Stretch}(puck||(puck={}));var puck;!function(t){var e=function(){function t(t){this.callback=t,this.enabled=!1,this.active=0}return t.prototype.enable=function(){var t=this;this.enabled=!0,this.active=n.request(function(e){return t.onFrame(e)})},t.prototype.disable=function(){this.enabled=!1,this.active&&(n.cancel(this.active),this.active=0)},t.prototype.onFrame=function(t){var e=this;this.callback&&this.callback(t),this.active=n.request(function(t){return e.onFrame(t)})},t}();t.Timer=e;var n;!function(t){function e(t){return r(t)}function n(t){return i(t)}var r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,5)},i=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(t){return window.clearTimeout(t)};t.request=e,t.cancel=n}(n||(n={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e=function(){function e(){this.$$dirt=t.DirtyFlags.none,this.transform=la.mat3.identity(),this.padding=la.padding.init(0,0,0,0),this.extents=la.rect.init(0,0,0,0),this.paint=la.rect.init(0,0,0,0)}return e.prototype.hasDirt=function(t){return(this.$$dirt&t)>0},e.prototype.taint=function(t){return this.$$dirt|=t,this},e.prototype.untaint=function(t){return this.$$dirt&=~t,this},e.prototype.reset=function(){return this.opacity=1,this.visible=!0,la.mat3.identity(this.transform),la.padding.init(0,0,0,0,this.padding),la.rect.init(0,0,0,0,this.extents),la.rect.init(0,0,0,0,this.paint),this.$$dirt=t.DirtyFlags.none,this},e.prototype.invalidate=function(){return this.taint(t.DirtyFlags.invalidate),la.rect.union(this.paint,this.extents),this},e}();t.ElementComposite=e}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.element.ElementComposite);e.ContainerComposite=n}(e=t.container||(t.container={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e=function(){function t(){this.opacity=1,this.visible=!0,this.offset={x:0,y:0},this.size={width:0,height:0},this.transform=la.mat3.identity(),this.transformOrigin={x:.5,y:.5}}return t.prototype.reset=function(){return this.opacity=1,this.visible=!0,this.offset.x=0,this.offset.y=0,this.size.width=0,this.size.height=0,la.mat3.identity(this.transform),this.transformOrigin.x=.5,this.transformOrigin.y=.5,this},t.prototype.mapTransformOrigin=function(t){var e=this.transformOrigin,n=this.size;return{x:e.x*n.width,y:e.y*n.height}},t}();t.ElementState=e}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.element.ElementState);e.ContainerState=n}(e=t.container||(t.container={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){function e(t,e,n,r){var i=t.processor.hit;i.process(t,e,n,r)}t.hit=e}(e=t.engine||(t.engine={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){function n(e,o){r(e,o);for(var s=[],a=t.walk.getWalker(e),c=a.next();c;c=a.next())n(c,e),s.push(c.composite);i(e,o,s)}function r(e,n){var r=e.processor.down,i={walker:t.walk.getWalker(e),state:e.state,composite:e.composite,pcomposite:n?n.composite:o};r.isTainted(i)&&(r.process(i),r.clear(i))}function i(t,e,n){var r=t.processor.up,i={state:t.state,composite:t.composite,ccomposites:n};if(r.isTainted(i)){var o=r.process(i);e&&e.composite.taint(o),r.clear(i)}}e.process=n;var o={opacity:1,visible:!0,transform:la.mat3.identity(),extents:la.rect.init(0,0,0,0),hasDirt:function(t){return!1},taint:function(t){},untaint:function(t){},reset:function(){}}}(e=t.engine||(t.engine={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){function n(){var t=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");return null!=t.exec(navigator.userAgent)?parseFloat(RegExp.$1):-1}var r=la.mat3,i=["butt","square","round","butt"],o=["miter","bevel","round"],s=function(){function s(){this.$$transforms=[],this.currentTransform=r.identity(),Object.defineProperties(this,{currentTransform:{value:r.identity(),writable:!1},hasFillRule:{value:s.hasFillRule,writable:!1},size:{value:new e.RenderContextSize,writable:!1}})}return Object.defineProperty(s,"hasFillRule",{get:function(){if("Microsoft Internet Explorer"===navigator.appName){var t=n();return 0>t||t>10}return!0},enumerable:!0,configurable:!0}),s.prototype.init=function(t){return Object.defineProperties(this,{raw:{value:t,writable:!1}}),this.size.init(t),this},s.prototype.applyDpiRatio=function(){var t=this.size.dpiRatio;this.scale(t,t)},s.prototype.save=function(){this.$$transforms.push(r.create(this.currentTransform)),this.raw.save()},s.prototype.restore=function(){var t=this.$$transforms.pop();t&&r.copyTo(t,this.currentTransform),this.raw.restore()},s.prototype.setTransform=function(t,e,n,i,o,s){r.init(this.currentTransform,t,e,n,i,o,s),this.raw.setTransform(t,e,n,i,o,s)},s.prototype.resetTransform=function(){r.identity(this.currentTransform);var t=this.raw;t.resetTransform&&t.resetTransform()},s.prototype.transform=function(t,e,n,i,o,s){var a=this.currentTransform;r.multiply(a,r.create([t,e,n,i,o,s]),a),this.raw.transform(t,e,n,i,o,s)},s.prototype.scale=function(t,e){r.scale(this.currentTransform,t,e),this.raw.scale(t,e)},s.prototype.rotate=function(t){var e=this.currentTransform,n=r.createRotate(t);r.multiply(e,n,e),this.raw.rotate(t)},s.prototype.translate=function(t,e){r.translate(this.currentTransform,t,e),this.raw.translate(t,e)},s.prototype.apply=function(t){var e=r.apply(this.currentTransform,t);this.raw.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},s.prototype.preapply=function(t){var e=r.preapply(this.currentTransform,t);this.raw.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},s.prototype.clipRect=function(t){var e=this.raw;e.beginPath(),e.rect(t.x,t.y,t.width,t.height),e.clip()},s.prototype.fillEx=function(e,n,r){var i=this.raw;if(n.setup(i,e),i.fillStyle=n.toHtml5Object(),null==r)i.fillRule=i.msFillRule="nonzero",i.fill();else{var o=r===t.FillRule.evenodd?"evenodd":"nonzero";i.fillRule=i.msFillRule=o,i.fill(o)}},s.prototype.strokeEx=function(t,e,n){var r=this.raw;e.setup(r,t),r.strokeStyle=e.toHtml5Object(),r.lineWidth=n,r.stroke()},s.prototype.isPointInStrokeEx=function(t,e,n){var r=this.raw;return r.lineWidth=n,r.isPointInStroke(t,e)},s.prototype.setStrokeExtras=function(t,e,n){var r=this.raw;r.lineCap=i[t||0]||i[0],r.lineJoin=o[e||0]||o[0],r.miterLimit=n},s}();e.RenderContext=s}(e=t.render||(t.render={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){function n(e,n,r){var i=e.processor.render,o={walker:t.walk.getWalker(e,!0),state:e.state,composite:e.composite,stencil:e.stencil,ctx:n,inregion:r,curregion:la.rect.init(0,0,0,0)};i.process(o),i.clear(o)}e.render=n}(e=t.engine||(t.engine={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){function n(t,e,n,o){r.isEmpty(n)&&(o.width=o.height=0);var s=i[e];s&&s(t,n,o)}var r=la.rect;e.calc=n;var i={};i[t.Stretch.none]=function(t,e,n){la.rect.copyTo(e,t)},i[t.Stretch.fill]=function(t,e,n){t.width=n.width,t.height=n.height},i[t.Stretch.uniform]=function(t,e,n){var r=n.width/e.width,i=n.height/e.height;t.width=n.width,t.height=n.height,i>r?t.height=e.height*r:t.width=e.width*i},i[t.Stretch.uniformToFill]=function(t,e,n){var r=n.width/e.width,i=n.height/e.height;t.width=n.width,t.height=n.height,r>i?t.height=e.height*r:t.width=e.width*i}}(n=e.extents||(e.extents={}))}(e=t.fit||(t.fit={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){function n(t,e,n,r){var o=i[e];o&&o(t,n,r)}var r=la.mat3;e.calc=n;var i={};i[t.Stretch.none]=function(t,e,n){r.identity(t)},i[t.Stretch.fill]=function(t,e,n){r.createTranslate(-e.x,-e.y,t),r.scale(t,n.width/e.width,n.height/e.height)},i[t.Stretch.uniform]=function(t,e,n){r.createTranslate(-e.x,-e.y,t);var i=Math.min(n.width/e.width,n.height/e.height);r.scale(t,i,i)},i[t.Stretch.uniformToFill]=function(t,e,n){r.createTranslate(-e.x,-e.y,t);var i=Math.max(n.width/e.width,n.height/e.height);r.scale(t,i,i)}}(n=e.transform||(e.transform={}))}(e=t.fit||(t.fit={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n=function(t){function e(){t.apply(this,arguments),this.stretchTransform=la.mat3.identity()}return __extends(e,t),e.prototype.reset=function(){return t.prototype.reset.call(this),la.mat3.identity(this.stretchTransform),this},e}(t.element.ElementComposite);e.ImageComposite=n}(e=t.image||(t.image={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e=function(){function t(){var t=this;this.$el=document.createElement("img"),this.$watchers=[],this.$el.onerror=function(e){return t.onErrored(e)},this.$el.onload=function(e){return t.onLoaded()}}return t.prototype.reset=function(){this.uri=""},Object.defineProperty(t.prototype,"uri",{get:function(){return this.$el.src},set:function(t){this.$el.src!==t&&(this.$el.src=t,this.onChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"naturalWidth",{get:function(){return this.$el.naturalWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"naturalHeight",{get:function(){return this.$el.naturalHeight},enumerable:!0,configurable:!0}),t.prototype.draw=function(t){t.drawImage(this.$el,0,0)},t.prototype.watch=function(t,e,n){var r=this,i={change:t,error:e,load:n,unwatch:function(){var t=r.$watchers.indexOf(i);t>-1&&r.$watchers.splice(t,1)}};return this.$watchers.push(i),i},t.prototype.onChanged=function(){for(var t=this.$watchers,e=0;e<t.length;e++)t[e].change()},t.prototype.onErrored=function(t){for(var e=this.$watchers,n=0;n<e.length;n++)e[n].error(t.error)},t.prototype.onLoaded=function(){for(var t=this.$watchers,e=0;e<t.length;e++)t[e].load()},t}();t.ImageSource=e}(e=t.image||(t.image={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n=function(n){function r(){n.apply(this,arguments),this.source=new e.ImageSource,this.stretch=t.Stretch.none,this.natural=la.rect.init(0,0,0,0)}return __extends(r,n),r.prototype.reset=function(){return n.prototype.reset.call(this),this.source.reset(),this.stretch=t.Stretch.none,la.rect.init(0,0,0,0,this.natural),this},r.prototype.getEffectiveStretch=function(){var e=this.size,n=this.natural;return e.width<=0||e.height<=0?t.Stretch.none:n.width<=0||n.height<=0?t.Stretch.none:this.stretch},r}(t.element.ElementState);e.ImageState=n}(e=t.image||(t.image={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e=function(){function t(){this.$watchers=[]}return t.prototype.watch=function(t){var e=this.$watchers,n={change:t,unwatch:function(){var t=e.indexOf(n);t>-1&&e.splice(t,1)}};return e.push(n),n},t.prototype.on=function(){for(var t=this.$watchers,e=0;e<t.length;e++)t[e].change()},t}();t.WatchChanger=e}(e=t.internal||(t.internal={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){function e(e,n,r){var i={x:e.x,y:e.y},o={x:n.x,y:n.y},s={x:n.x-e.x,y:n.y-e.y};t.calcMetrics(s,i,o,r);var a=(o.x-i.x)/s.x,c=1/a,u=-c;return{x0:i.x,y0:i.y,x1:o.x,y1:o.y,step:function(){return u+=c,1>u},interpolate:function(t){return u+t/a}}}function n(e,n,r){var i={x:e.x,y:e.y},o={x:n.x,y:n.y},s={x:n.x-e.x,y:n.y-e.y};t.calcMetrics(s,i,o,r);var a=(o.x-i.x)/s.x,c=1/a,u=-c,p=Math.round((e.x-i.x)/s.x)%2===0;return{x0:i.x,y0:i.y,x1:o.x,y1:o.y,step:function(){return p=!p,u+=c,1>u},interpolate:function(t){var e=t/a;return p?u+(c-e):u+e}}}t.createRepeatInterpolator=e,t.createReflectInterpolator=n}(e=t.linearGradient||(t.linearGradient={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){function e(t,e,p,f){0===t.y?t.x<0?r(t,e,p,f):0!==t.x&&n(t,e,p,f):0===t.x?t.y<0?o(t,e,p,f):0!==t.y&&i(t,e,p,f):t.x<0&&t.y<0?s(t,e,p,f):t.x<0&&t.y>0?a(t,e,p,f):t.x>0&&t.y<0?c(t,e,p,f):t.x>0&&t.y>0&&u(t,e,p,f)}function n(t,e,n,r){for(var i=r.x+r.width;e.x>=r.x;)e.x-=t.x;for(;n.x<=i;)n.x+=t.x}function r(t,e,n,r){for(var i=r.x+r.width;e.x<=i;)e.x-=t.x;for(;n.x>=r.x;)n.x+=t.x}function i(t,e,n,r){for(var i=r.y+r.height;e.y>=r.y;)e.y-=t.y;for(;n.y<=i;)n.y+=t.y}function o(t,e,n,r){for(var i=r.y+r.height;e.y<=i;)e.y-=t.y;for(;n.y>=r.y;)n.y+=t.y}function s(t,e,n,r){for(var i=r.x+r.width,o=r.y+r.height;e.x<=i&&e.y<=o;)e.x-=t.x,e.y-=t.y;for(;n.x>=r.x&&n.y>=r.y;)n.x+=t.x,n.y+=t.y}function a(t,e,n,r){for(var i=r.x+r.width,o=r.y+r.height;e.x<=i&&e.y>=r.y;)e.x-=t.x,e.y-=t.y;for(;n.x>=r.x&&n.y<=o;)n.x+=t.x,n.y+=t.y}function c(t,e,n,r){for(var i=r.x+r.width,o=r.y+r.height;e.x>=r.x&&e.y<=o;)e.x-=t.x,e.y-=t.y;for(;n.x<=i&&n.y>=r.y;)n.x+=t.x,n.y+=t.y}function u(t,e,n,r){for(var i=r.x+r.width,o=r.y+r.height;e.x>=r.x&&e.y>=r.y;)e.x-=t.x,e.y-=t.y;for(;n.x<=i&&n.y<=o;)n.x+=t.x,n.y+=t.y}t.calcMetrics=e}(e=t.linearGradient||(t.linearGradient={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e=curve.bounds.fill.FillBounds,n=curve.bounds.stroke.StrokeBounds,r=function(){function t(){this.$path=null,this.$filled=null,this.$stroked=null,this.$pars={strokeThickness:0,strokeDashArray:null,strokeDashCap:curve.PenLineCap.Flat,strokeDashOffset:0,strokeEndLineCap:curve.PenLineCap.Flat,strokeLineJoin:curve.PenLineJoin.Miter,strokeMiterLimit:10,strokeStartLineCap:curve.PenLineCap.Flat}}return t.prototype.getPath=function(){return this.$path},t.prototype.setPath=function(t){this.$path!==t&&(this.$path=t,t?(this.$filled=new e(t),this.$stroked=new n(t),this.$stroked.pars=this.$pars):(this.$filled=null,this.$stroked=null))},t.prototype.reset=function(){this.$filled&&this.$filled.reset(),this.$stroked&&this.$stroked.reset()},t.prototype.getFillRect=function(t){var e=this.$filled;return e?(t.x=e.l,t.y=e.t,t.width=e.r-e.l,t.height=e.b-e.t):la.rect.init(0,0,0,0,t),this},t.prototype.getStrokeRect=function(t){var e=this.$stroked;return e?(t.x=e.l,t.y=e.t,t.width=e.r-e.l,t.height=e.b-e.t):la.rect.init(0,0,0,0,t),this},t.prototype.calc=function(t){var e=this.$stroked,n=this.$filled;return e&&(t.stroke&&t.strokeThickness>0?(this.setStroke(t),e.ensure()):e.reset()),n&&n.ensure(),this},t.prototype.setStroke=function(t){var e=this.$pars;e.strokeThickness=t.strokeThickness,e.strokeStartLineCap=t.strokeLineCap,e.strokeLineJoin=t.strokeLineJoin,e.strokeMiterLimit=t.strokeMiterLimit},t}();t.Bounder=r}(e=t.path||(t.path={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n=function(t){function n(){t.apply(this,arguments),this.stretchTransform=la.mat3.identity(),this.natural=la.rect.init(0,0,0,0),this.bounder=new e.Bounder}return __extends(n,t),n.prototype.reset=function(){return t.prototype.reset.call(this),la.mat3.identity(this.stretchTransform),la.rect.init(0,0,0,0,this.natural),this.bounder.reset(),this},n}(t.element.ElementComposite);e.PathComposite=n}(e=t.path||(t.path={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n=t.element.ElementState,r=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.reset=function(){return t.prototype.reset.call(this),this.fill=null,this.stroke=null,this.strokeThickness=0,this},e}(n);e.VisualState=r}(e=t.visual||(t.visual={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n=function(e){function n(){e.apply(this,arguments),this.path=null,this.stretch=t.Stretch.none,this.fillRule=t.FillRule.evenodd,this.strokeLineCap=t.PenLineCap.flat,this.strokeLineJoin=t.PenLineJoin.miter,this.strokeMiterLimit=10}return __extends(n,e),n.prototype.reset=function(){return e.prototype.reset.call(this),this.path=null,this.stretch=t.Stretch.none,this.fillRule=t.FillRule.evenodd,this.strokeLineCap=t.PenLineCap.flat,this.strokeLineJoin=t.PenLineJoin.miter,this.strokeMiterLimit=10,this},n.prototype.getEffectiveStretch=function(e){var n=this.size,r=e.natural;return n.width<=0||n.height<=0?t.Stretch.none:r.width<=0||r.height<=0?t.Stretch.none:this.stretch},n.prototype.mapTransformOrigin=function(e){var n=this.transformOrigin,r=la.rect.init(0,0,0,0);return t.fit.extents.calc(r,this.getEffectiveStretch(e),e.natural,this.size),{x:r.x+n.x*r.width,y:r.y+n.y*r.height}},n}(t.visual.VisualState);e.PathState=n}(e=t.path||(t.path={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n=function(e){function n(){e.apply(this,arguments),this.points=new t.Points,this.closed=!1}return __extends(n,e),n.prototype.reset=function(){return e.prototype.reset.call(this),this.points.clear(),this.closed=!1,this},n}(t.path.PathState);e.PolylineState=n}(e=t.polyline||(t.polyline={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){function e(t,e){var r=!1,i=t.x1-t.x0,o=t.y1-t.y0,s=t.r1,a=!1,c={x0:t.x0,y0:t.y0,r0:0,x1:t.x1,y1:t.y1,r1:t.r1,step:function(){return r?(c.x0=c.x1,c.y0=c.y1,c.r0+=s,c.r1+=s,c.x1+=i,c.y1+=o,a?!1:(a=n(c.x1,c.y1,c.r1,e),!0)):(r=!0,!0)},createGradient:function(t){return t.createRadialGradient(c.x0,c.y0,c.r0,c.x1,c.y1,c.r1)}};return c}function n(t,e,n,i){var o=r(t,e,i.x,i.y),s=r(t,e,i.x+i.width,i.y),a=r(t,e,i.x+i.width,i.y+i.height),c=r(t,e,i.x,i.y+i.height);return Math.max(o,s,a,c)<n}function r(t,e,n,r){var i=n-t,o=r-e;return Math.sqrt(i*i+o*o)}t.createExtender=e}(e=t.radialGradient||(t.radialGradient={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){function e(e){var n=t.zoom.calc();return{width:e.offsetWidth*n,height:e.offsetHeight*n}}t.getNaturalCanvasSize=e}(e=t.render||(t.render={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e=1e-10,n=function(){function n(){this.$$ctx=null,this.$$desiredWidth=0,this.$$desiredHeight=0,this.$$changed=null,this.$$lastDpiRatio=1}return Object.defineProperty(n.prototype,"desiredWidth",{get:function(){return this.$$desiredWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"desiredHeight",{get:function(){return this.$$desiredHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paintWidth",{get:function(){return this.$$desiredWidth*this.dpiRatio},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paintHeight",{get:function(){return this.$$desiredHeight*this.dpiRatio},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dpiRatio",{get:function(){return(window.devicePixelRatio||1)/this.$$ctx.backingStorePixelRatio},enumerable:!0,configurable:!0}),n.prototype.init=function(e){this.$$ctx=e;var n=t.getNaturalCanvasSize(e.canvas);this.$$desiredWidth=n.width,this.$$desiredHeight=n.height,this.$adjustCanvas()},n.prototype.queueResize=function(t,e){return this.$$changed?(this.$$changed.width=t,this.$$changed.height=e):this.$$changed={width:t,height:e},this},n.prototype.commitResize=function(){if(this.$$changed){if(Math.abs(this.$$changed.width-this.$$desiredWidth)<e&&Math.abs(this.$$changed.height-this.$$desiredHeight)<e)return;this.$$desiredWidth=this.$$changed.width,this.$$desiredHeight=this.$$changed.height,this.$$changed=null,this.$adjustCanvas()}return this},n.prototype.updateDpiRatio=function(){return this.$$lastDpiRatio===this.dpiRatio?!1:(this.$adjustCanvas(),!0)},n.prototype.$adjustCanvas=function(){var t=this.$$ctx.canvas,n=this.dpiRatio;Math.abs(n-1)<e?(t.width=this.desiredWidth,t.height=this.desiredHeight):(t.width=this.paintWidth,t.height=this.paintHeight,t.style.width=this.desiredWidth.toString()+"px",t.style.height=this.desiredHeight.toString()+"px"),this.$$lastDpiRatio=n},n}();t.RenderContextSize=n}(e=t.render||(t.render={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(t){function e(){return function(){var t=document.frames.screen,e=t.deviceXDPI/t.systemXDPI;return Math.round(100*e)/100}}function n(){function t(){!e&&document.body&&(e=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("version","1.1"),document.body.appendChild(e),function(t){t.opacity="0.0",t.position="absolute",t.left="-300px"}(e.style))}var e;return function(){return t(),e?e.currentScale:1}}t.calc=function(){return document.frames?e():n()}()}(e=t.zoom||(t.zoom={}))}(e=t.render||(t.render={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){t.empty={draft:function(t){},draw:function(t,e){}}}(e=t.stencil||(t.stencil={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){t.path={draft:function(t){var e=t.composite;e.bounder.getFillRect(t.fillRect).getStrokeRect(t.strokeRect)},draw:function(t,e){var n=e.fillRect;if(!(n.width<=0||n.height<=0)){var r=t.raw,i=e.state;r.beginPath(),i.path.draw(r)}}}}(e=t.stencil||(t.stencil={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n=t.element.ElementComposite,r=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(n);e.VisualComposite=r}(e=t.visual||(t.visual={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){function e(t,e){return"function"==typeof t.walk?t.walk(e):n}var n={next:function(){}};t.getWalker=e}(e=t.walk||(t.walk={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(e){var n=function(){function n(){}return n.prototype.isTainted=function(e){return e.composite.hasDirt(t.DirtyFlags.down)},n.prototype.process=function(n){var r=t.DirtyFlags.none;return e.opacity.process(n)&&(r|=t.DirtyFlags.opacity),e.visible.process(n)&&(r|=t.DirtyFlags.visible),e.transform.process(n)&&(r|=t.DirtyFlags.transform),r},n.prototype.clear=function(e){return e.composite.untaint(t.DirtyFlags.down),this},n.instance=new n,n}();e.Processor=n}(e=t.down||(t.down={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.process=function(e){for(var n=t.prototype.process.call(this,e),r=e.walker.next();r;r=e.walker.next())r.composite.taint(n);return n},e.instance=new e,e}(t.element.down.Processor);e.Processor=n}(n=e.down||(e.down={}))}(e=t.container||(t.container={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(t){var e=la.mat3,n=la.vec2,r=la.rect,i=function(){function t(){}return t.prototype.process=function(t,e,n,r){if(this.prehit(t,e,n)){e.save(),e.preapply(t.composite.transform);var i=!1;return this.hit(t,e,n,r)&&(i=!0,r.unshift(t)),e.restore(),i}},t.prototype.prehit=function(t,i,o){var s=t.composite;if(!s.visible||255*s.opacity<.5)return!1;var a=e.transformVec2(i.currentTransform,o,n.create(0,0));return r.containsVec2(s.extents,a)},t.prototype.hit=function(t,e,n,r){return!1},t.prototype.draw=function(t,e){var n={state:t.state,composite:t.composite,fillRect:null,strokeRect:null};t.stencil.draw(e,n)},t.instance=new t,t}();t.Processor=i}(e=t.hit||(t.hit={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),n.prototype.hit=function(e,n,r,i){for(var o=e.walk(!0),s=o.next();s;s=o.next())if(t.engine.hit(e,n,r,i))return!0;return!1},n.instance=new n,n}(t.element.hit.Processor);e.Processor=n}(n=e.hit||(e.hit={}))}(e=t.container||(t.container={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(e){!function(t){t[t.none=0]="none",t[t.render=2]="render",t[t.post=4]="post",t[t.all=6]="all"}(e.SkipResult||(e.SkipResult={}));var n=e.SkipResult,r=function(){function r(){}return r.prototype.process=function(t){var e=this.prerender(t);0===(e&n.render)&&this.render(t),0===(e&n.post)&&this.postrender(t)},r.prototype.clear=function(e){return e.composite.untaint(t.DirtyFlags.invalidate),la.rect.init(0,0,0,0,e.composite.paint),this},r.prototype.prerender=function(t){return e.validate.process(t)&&e.should.process(t)?(e.prepare.process(t),e.narrow.process(t),n.none):n.all},r.prototype.render=function(t){var e=this.createStencilBag(t);t.stencil.draft(e),t.stencil.draw(t.ctx,e)},r.prototype.postrender=function(t){t.ctx.restore()},r.prototype.createStencilBag=function(t){return{state:t.state,composite:t.composite,fillRect:la.rect.init(0,0,0,0),strokeRect:la.rect.init(0,0,0,0)}},r.instance=new r,r}();e.Processor=r}(e=t.render||(t.render={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),n.prototype.render=function(e){for(var n=e.walker.next();n;n=e.walker.next())t.engine.render(n,e.ctx,e.curregion)},n.instance=new n,n}(t.element.render.Processor);e.Processor=n}(n=e.render||(e.render={}))}(e=t.container||(t.container={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n;!function(e){function n(t){var e=t.composite;if(!e.hasDirt(i.extents))return!1;r.copyTo(e.extents,o),r.init(0,0,0,0,e.extents);for(var n=t.ccomposites,s=0;s<n.length;s++)r.union(e.extents,n[s].extents);return r.transform(e.extents,e.transform,e.extents),r.equal(e.extents,o)?!1:(r.union(e.paint,o),e.taint(i.newbounds),!0)}var r=la.rect,i=t.element.DirtyFlags,o=r.init(0,0,0,0);e.process=n}(n=e.extents||(e.extents={}))}(n=e.up||(e.up={}))}(e=t.container||(t.container={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n;!function(e){function n(t){var e=t.composite;if(!e.hasDirt(r.invalidate))return!1;for(var n=la.rect.init(0,0,0,0),i=t.ccomposites,o=0;o<i.length;o++)la.rect.union(n,i[o].paint);return la.rect.transform(n,e.transform,n),la.rect.union(e.paint,n),!0}var r=t.element.DirtyFlags;e.process=n}(n=e.invalidate||(e.invalidate={}))}(n=e.up||(e.up={}))}(e=t.container||(t.container={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(e){var n=function(){function n(){}return n.prototype.isTainted=function(e){return e.composite.hasDirt(t.DirtyFlags.up)},n.prototype.process=function(n){var r=t.DirtyFlags.none;return e.extents.process(n)&&(r|=t.DirtyFlags.extents),e.newbounds.process(n),r},n.prototype.clear=function(e){return e.composite.untaint(t.DirtyFlags.up),this},n.instance=new n,n}();e.Processor=n}(e=t.up||(t.up={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(e){var n;!function(e){function n(e){var n=e.composite;return!n.hasDirt(t.DirtyFlags.newbounds)||!n.visible||255*n.opacity<.5?!1:(n.invalidate(),!0)}e.process=n}(n=e.newbounds||(e.newbounds={}))}(e=t.up||(t.up={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=t.element.DirtyFlags,r=t.element.up.newbounds,i=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype.process=function(t){var i=n.none;return e.extents.process(t)&&(i|=n.extents),r.process(t),e.invalidate.process(t)&&(i|=n.invalidate),i},i.instance=new i,i}(t.element.up.Processor);e.Processor=i}(n=e.up||(e.up={}))}(e=t.container||(t.container={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(e){var n;!function(e){function n(e){var n=e.composite;if(!n.hasDirt(t.DirtyFlags.opacity))return!1;var r=e.pcomposite.opacity*e.state.opacity;return n.opacity===r?!1:(n.taint(t.DirtyFlags.newbounds),n.opacity=r,!0)}e.process=n}(n=e.opacity||(e.opacity={}))}(e=t.down||(t.down={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(e){var n;!function(e){function n(e){var n=e.composite;if(!n.hasDirt(t.DirtyFlags.transform))return!1;r.copyTo(n.transform,i);var o=e.state,s=o.mapTransformOrigin(n);return r.createTranslate(-s.x,-s.y,n.transform),r.apply(n.transform,o.transform),r.translate(n.transform,s.x,s.y),r.translate(n.transform,o.offset.x,o.offset.y),r.equal(n.transform,i)||n.taint(t.DirtyFlags.extents),!0}var r=la.mat3,i=r.identity();e.process=n}(n=e.transform||(e.transform={}))}(e=t.down||(t.down={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(e){var n;!function(e){function n(e){var n=e.composite;if(!n.hasDirt(t.DirtyFlags.visible))return!1;
var r=e.pcomposite.visible&&e.state.visible===!0;return n.visible===r?!1:(n.taint(t.DirtyFlags.newbounds),n.visible=r,!0)}e.process=n}(n=e.visible||(e.visible={}))}(e=t.down||(t.down={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(e){var n;!function(e){function n(e){var n=e.composite;if(!n.hasDirt(t.DirtyFlags.extents))return!1;var o=e.state;return r.copyTo(n.extents,i),r.init(0,0,o.size.width,o.size.height,n.extents),r.grow(n.extents,n.padding),r.transform(n.extents,n.transform,n.extents),r.equal(n.extents,i)?!1:(r.union(n.paint,i),n.taint(t.DirtyFlags.newbounds),!0)}var r=la.rect,i=r.init(0,0,0,0);e.process=n}(n=e.extents||(e.extents={}))}(e=t.up||(t.up={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t){}t.process=e}(e=t.narrow||(t.narrow={}))}(e=t.render||(t.render={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t){t.ctx.save(),t.ctx.preapply(t.composite.transform)}t.process=e}(e=t.prepare||(t.prepare={}))}(e=t.render||(t.render={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t){var e=n.transform(t.composite.extents,t.ctx.currentTransform,t.curregion);return n.roundOut(e),n.intersection(e,t.inregion),e.width>0&&e.height>0}var n=la.rect;t.process=e}(e=t.should||(t.should={}))}(e=t.render||(t.render={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t){var e=t.composite;return!!e.visible&&255*e.opacity>=.5}t.process=e}(e=t.validate||(t.validate={}))}(e=t.render||(t.render={}))}(e=t.element||(t.element={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.process=function(n){return e.stretch.process(n),t.prototype.process.call(this,n)},n.instance=new n,n}(t.element.down.Processor);e.Processor=n}(n=e.down||(e.down={}))}(e=t.image||(t.image={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n;!function(e){function n(e){var n=e.state,s=e.composite;return s.hasDirt(r.stretch)?(i.copyTo(s.stretchTransform,o),t.fit.transform.calc(s.stretchTransform,n.getEffectiveStretch(),n.natural,n.size),i.equal(s.stretchTransform,o)?!1:(s.taint(r.extents),!0)):!1}var r=t.element.DirtyFlags,i=la.mat3,o=i.identity();e.process=n}(n=e.stretch||(e.stretch={}))}(n=e.down||(e.down={}))}(e=t.image||(t.image={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.hit=function(t,e,n,r){return!0},e.instance=new e,e}(t.element.hit.Processor);e.Processor=n}(n=e.hit||(e.hit={}))}(e=t.image||(t.image={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n;!function(e){function n(e){var n=e.composite;if(!n.hasDirt(r.extents))return!1;var s=e.state;return i.copyTo(n.extents,o),i.init(0,0,0,0,n.extents),t.fit.extents.calc(n.extents,s.getEffectiveStretch(),s.natural,s.size),i.transform(n.extents,n.transform,n.extents),i.equal(n.extents,o)?!1:(i.union(n.paint,o),n.taint(r.newbounds),!0)}var r=t.element.DirtyFlags,i=la.rect,o=i.init(0,0,0,0);e.process=n}(n=e.extents||(e.extents={}))}(n=e.up||(e.up={}))}(e=t.image||(t.image={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=t.element.DirtyFlags,r=t.element.up.newbounds,i=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype.process=function(t){var i=n.none;return e.extents.process(t)&&(i|=n.extents),r.process(t),i},i.instance=new i,i}(t.element.up.Processor);e.Processor=i}(n=e.up||(e.up={}))}(e=t.image||(t.image={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n;!function(e){function n(t){var e=t.state,n=t.composite;return n.hasDirt(r.padding)?(n.bounder.reset(),la.rect.copyTo(n.natural,i),n.bounder.calc(e).getFillRect(o).getStrokeRect(s),la.rect.union(o,s,n.natural),la.rect.equal(n.natural,i)?(n.taint(r.stretch),!0):!1):!1}var r=t.element.DirtyFlags,i=la.rect.init(0,0,0,0),o=la.rect.init(0,0,0,0),s=la.rect.init(0,0,0,0);e.process=n}(n=e.natural||(e.natural={}))}(n=e.down||(e.down={}))}(e=t.path||(t.path={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.process=function(n){return e.natural.process(n),e.stretch.process(n),t.prototype.process.call(this,n)},n.instance=new n,n}(t.element.down.Processor);e.Processor=n}(n=e.down||(e.down={}))}(e=t.path||(t.path={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n;!function(e){function n(e){var n=e.state,s=e.composite;return s.hasDirt(r.stretch)?(i.copyTo(s.stretchTransform,o),t.fit.transform.calc(s.stretchTransform,n.getEffectiveStretch(s),s.natural,n.size),i.equal(s.stretchTransform,o)?!1:(s.taint(r.extents),!0)):!1}var r=t.element.DirtyFlags,i=la.mat3,o=i.identity();e.process=n}(n=e.stretch||(e.stretch={}))}(n=e.down||(e.down={}))}(e=t.path||(t.path={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.prehit=function(e,n,r){if(!t.prototype.prehit.call(this,e,n,r))return!1;var i=e.state;return!!i.fill||!!i.stroke&&i.strokeThickness>0},e.prototype.hit=function(t,e,n,r){e.save(),this.transformLocal(t,e),this.draw(t,e);var i=t.state,o=n[0],s=n[1],a=!1;return i.fill&&e.raw.isPointInPath(o,s)?a=!0:i.stroke&&e.isPointInStrokeEx(o,s,i.strokeThickness)&&(a=!0),e.restore(),a},e.prototype.transformLocal=function(t,e){},e.instance=new e,e}(t.element.hit.Processor);e.Processor=n}(n=e.hit||(e.hit={}))}(e=t.visual||(t.visual={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.hit=function(t,e,n,r){e.save(),this.transformLocal(t,e),this.draw(t,e);var i=t.state,o=n[0],s=n[1],a=!1;return i.fill&&e.raw.isPointInPath(o,s)?a=!0:i.stroke&&(e.setStrokeExtras(i.strokeLineCap,i.strokeLineJoin,i.strokeMiterLimit),e.isPointInStrokeEx(o,s,i.strokeThickness)&&(a=!0)),e.restore(),a},e.prototype.transformLocal=function(t,e){e.preapply(t.composite.stretchTransform)},e.instance=new e,e}(t.visual.hit.Processor);e.Processor=n}(n=e.hit||(e.hit={}))}(e=t.path||(t.path={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.render=function(t){var e=t.state;if(!e.fill&&!e.stroke)return!1;var n=t.ctx;n.save();var r=this.createStencilBag(t);t.stencil.draft(r),this.transformLocal(n,r),t.stencil.draw(n,r),this.fill(n,e,r),this.stroke(n,e,r),n.restore()},e.prototype.transformLocal=function(t,e){},e.prototype.fill=function(t,e,n){e.fill&&t.fillEx(n.fillRect,e.fill)},e.prototype.stroke=function(t,e,n){!e.stroke||e.strokeThickness<=0||t.strokeEx(n.strokeRect,e.stroke,e.strokeThickness)},e.instance=new e,e}(t.element.render.Processor);e.Processor=n}(n=e.render||(e.render={}))}(e=t.visual||(t.visual={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.transformLocal=function(t,e){var n=e.composite;t.preapply(n.stretchTransform)},e.prototype.fill=function(t,e,n){e.fill&&t.fillEx(n.fillRect,e.fill,e.fillRule)},e.prototype.stroke=function(t,e,n){!e.stroke||e.strokeThickness<=0||(t.setStrokeExtras(e.strokeLineCap,e.strokeLineJoin,e.strokeMiterLimit),t.strokeEx(n.strokeRect,e.stroke,e.strokeThickness))},e.instance=new e,e}(t.visual.render.Processor);e.Processor=n}(n=e.render||(e.render={}))}(e=t.path||(t.path={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n;!function(e){function n(e){var n=e.composite;if(!n.hasDirt(r.extents))return!1;var s=e.state;return i.copyTo(n.extents,o),i.init(0,0,0,0,n.extents),t.fit.extents.calc(n.extents,s.getEffectiveStretch(n),n.natural,s.size),i.transform(n.extents,n.transform,n.extents),i.equal(n.extents,o)?!1:(i.union(n.paint,o),n.taint(r.newbounds),!0)}var r=t.element.DirtyFlags,i=la.rect,o=i.init(0,0,0,0);e.process=n}(n=e.extents||(e.extents={}))}(n=e.up||(e.up={}))}(e=t.path||(t.path={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=t.element.DirtyFlags,r=t.element.up.newbounds,i=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype.process=function(t){var i=n.none;return e.extents.process(t)&&(i|=n.extents),r.process(t),i},i.instance=new i,i}(t.element.up.Processor);e.Processor=i}(n=e.up||(e.up={}))}(e=t.path||(t.path={}))}(puck||(puck={})),CanvasRenderingContext2D.prototype.hasOwnProperty("backingStorePixelRatio")||Object.defineProperty(CanvasRenderingContext2D.prototype,"backingStorePixelRatio",{get:function(){var t=this;return t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||1}}),CanvasRenderingContext2D.prototype.ellipse||(CanvasRenderingContext2D.prototype.ellipse=function(t,e,n,r,i,o,s,a){this.save(),this.translate(t,e),this.rotate(i),this.scale(n,r),this.arc(0,0,1,o,s,a),this.restore()}),CanvasRenderingContext2D.prototype.isPointInStroke||(CanvasRenderingContext2D.prototype.isPointInStroke=function(t,e){return!1});var puck;!function(t){var e;!function(e){var n;!function(e){var n;!function(e){function n(t){var e=t.state,n=t.composite,i=e.path;if(i){if(!i.isEmpty)return!1}else n.bounder.setPath(i=e.path=new curve.Path);for(var o=!0,s=e.points.iter(),a=s.next();!a.done;a=s.next()){var c=a.value;o?(o=!1,i.moveTo(c.x,c.y)):i.lineTo(c.x,c.y)}return e.closed&&i.closePath(),n.taint(r.padding),!0}var r=t.element.DirtyFlags;e.process=n}(n=e.points||(e.points={}))}(n=e.down||(e.down={}))}(e=t.polyline||(t.polyline={}))}(puck||(puck={}));var puck;!function(t){var e;!function(e){var n;!function(e){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.process=function(n){return e.points.process(n),t.prototype.process.call(this,n)},n.instance=new n,n}(t.path.down.Processor);e.Processor=n}(n=e.down||(e.down={}))}(e=t.polyline||(t.polyline={}))}(puck||(puck={}));
//# sourceMappingURL=puck.min.js.map
